# Development configuration - với hot reload và debugging
version: '3.8'

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: drone_delivery_db_dev
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=DevPassword123!
      - MSSQL_PID=Developer
    ports:
      - "1433:1433"
    volumes:
      - sqlserver_dev_data:/var/opt/mssql
    networks:
      - drone_network_dev

  user_service:
    build:
      context: ./user_service
      dockerfile: Dockerfile
    container_name: user_service_dev
    volumes:
      - ./user_service:/app
    environment:
      - DATABASE_URL=mssql+pyodbc://sa:DevPassword123!@sqlserver:1433/DroneDeliveryDB?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes
      - JWT_SECRET=dev-secret-key
      - DEBUG=true
    ports:
      - "8001:8000"
    depends_on:
      - sqlserver
    networks:
      - drone_network_dev
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  product_service:
    build:
      context: ./product_service
      dockerfile: Dockerfile
    container_name: product_service_dev
    volumes:
      - ./product_service:/app
    environment:
      - DATABASE_URL=mssql+pyodbc://sa:DevPassword123!@sqlserver:1433/DroneDeliveryDB?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes
      - USER_SERVICE_URL=http://user_service:8000
      - DEBUG=true
    ports:
      - "8002:8000"
    depends_on:
      - sqlserver
      - user_service
    networks:
      - drone_network_dev
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

networks:
  drone_network_dev:
    driver: bridge

volumes:
  sqlserver_dev_data: